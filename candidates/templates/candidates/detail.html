{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{{ candidate.full_name }} - {% trans "Independent Candidate" %} - ElectNepal{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Main Profile Container -->
    <div class="bg-white rounded-xl border border-gray-300 shadow-lg overflow-hidden p-8">
        <!-- Top Section with Photo and Location Info -->
        <div class="flex flex-col lg:flex-row gap-8 mb-8">
            <!-- Left Side - Photo and Name -->
            <div>
                <!-- Photo -->
                <div class="mb-4">
                    {% if candidate.photo %}
                        <img src="{{ candidate.photo.url }}" alt="{{ candidate.full_name }}"
                             class="rounded-lg shadow-xl object-cover" style="width: 8.5cm; height: 9cm;">
                    {% else %}
                        <div class="rounded-lg border border-gray-300 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center" style="width: 8.5cm; height: 9cm;">
                            <span class="text-white text-6xl font-bold">{{ candidate.full_name|first }}</span>
                        </div>
                    {% endif %}
                </div>

                <!-- Name below photo -->
                <h1 class="text-2xl font-bold text-gray-900 mb-2 text-center" style="width: 8.5cm;">{{ candidate.full_name }}</h1>

                <!-- Age below name -->
                {% if candidate.age %}
                <div class="text-lg text-gray-700 mb-2 text-center" style="width: 8.5cm;">
                    <span class="text-gray-600">{% trans "Age:" %}</span> {{ candidate.age }} {% trans "years" %}
                </div>
                {% endif %}

                <!-- Office below age -->
                <div class="text-lg font-semibold text-gray-700 mb-1 text-center" style="width: 8.5cm;">
                    <span class="text-gray-600">{% trans "Office:" %}</span>
                    {{ candidate.get_office_display }}
                </div>

                <!-- Seat/Position below office -->
                <div class="text-lg font-semibold text-gray-700 mb-2 text-center" style="width: 8.5cm;">
                    <span class="text-gray-600">{% trans "Seat:" %}</span>
                    {% if candidate.position_level == 'federal' %}
                        {% trans "Member of Parliament" %}
                    {% elif candidate.position_level == 'provincial' %}
                        {% trans "Provincial Assembly Member" %}
                    {% elif candidate.position_level == 'local_executive' %}
                        {% if 'Mayor' in candidate.get_position_level_display %}
                            {% trans "Mayor" %}
                        {% else %}
                            {% trans "Chairperson" %}
                        {% endif %}
                    {% elif candidate.position_level == 'ward' %}
                        {% trans "Ward Representative" %}
                    {% else %}
                        {{ candidate.get_position_level_display }}
                    {% endif %}
                </div>
            </div>

            <!-- Right Side - Location, Education, Experience -->
            <div class="flex-1">
                <!-- Location Info -->
                <div class="mb-6">
                    <div class="text-lg font-semibold text-gray-700">
                        <span class="text-gray-600">{% trans "From:" %}</span>
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if candidate.ward_number %}{% trans "Ward" %} {{ candidate.ward_number }}, {% endif %}
                        {% if candidate.municipality %}
                            {% if LANGUAGE_CODE == 'ne' %}{{ candidate.municipality.name_ne }}{% else %}{{ candidate.municipality.name_en }}{% endif %},
                        {% endif %}
                        {% if candidate.district %}
                            {% if LANGUAGE_CODE == 'ne' %}{{ candidate.district.name_ne }}{% else %}{{ candidate.district.name_en }}{% endif %},
                        {% endif %}
                        {% if candidate.province %}
                            {% if LANGUAGE_CODE == 'ne' %}{{ candidate.province.name_ne }}{% else %}{{ candidate.province.name_en }}{% endif %}
                        {% endif %}
                    </div>
                </div>


                <!-- Education -->
                {% if candidate.education_en or candidate.education_ne %}
                <div class="mb-6">
                    <h2 class="text-lg font-bold text-gray-900 mb-3">
                        {% trans "Education" %}
                    </h2>
                    <div class="text-gray-700 text-sm leading-relaxed education-content">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'ne' and candidate.education_ne %}
                            <ul class="list-none space-y-1">
                            {% for line in candidate.education_ne.splitlines %}
                                {% if line.strip %}
                                <li class="flex items-start">
                                    <span class="mr-2">•</span>
                                    <span>{{ line.strip }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        {% else %}
                            <ul class="list-none space-y-1">
                            {% for line in candidate.education_en.splitlines %}
                                {% if line.strip %}
                                <li class="flex items-start">
                                    <span class="mr-2">•</span>
                                    <span>{{ line.strip }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Past Experience -->
                {% if candidate.experience_en or candidate.experience_ne %}
                <div class="mb-6">
                    <h2 class="text-lg font-bold text-gray-900 mb-3">
                        {% trans "Past Experience" %}
                    </h2>
                    <div class="text-gray-700 text-sm leading-relaxed experience-content" id="experience-content">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'ne' and candidate.experience_ne %}
                            <ul class="list-none space-y-1">
                            {% for line in candidate.experience_ne.splitlines %}
                                {% if line.strip %}
                                <li class="flex items-start">
                                    <span class="mr-2">•</span>
                                    <span>{{ line.strip }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        {% else %}
                            <ul class="list-none space-y-1">
                            {% for line in candidate.experience_en.splitlines %}
                                {% if line.strip %}
                                <li class="flex items-start">
                                    <span class="mr-2">•</span>
                                    <span>{{ line.strip }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Key Achievements -->
                {% if candidate.achievements_en or candidate.achievements_ne %}
                <div>
                    <h2 class="text-lg font-bold text-gray-900 mb-3">
                        {% trans "Key Achievements" %}
                    </h2>
                    <div class="text-gray-700 text-sm leading-relaxed achievements-content">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'ne' and candidate.achievements_ne %}
                            <ul class="list-none space-y-1">
                            {% for line in candidate.achievements_ne.splitlines %}
                                {% if line.strip %}
                                <li class="flex items-start">
                                    <span class="mr-2">•</span>
                                    <span>{{ line.strip }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        {% else %}
                            <ul class="list-none space-y-1">
                            {% for line in candidate.achievements_en.splitlines %}
                                {% if line.strip %}
                                <li class="flex items-start">
                                    <span class="mr-2">•</span>
                                    <span>{{ line.strip }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Full Width Section - Motivation and Manifesto -->
        <div class="border-t border-gray-300 pt-8">
            <!-- Personal Motivation -->
            {% if candidate.bio_en or candidate.bio_ne %}
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">
                    {% trans "Motivation" %}
                </h2>
                <div class="text-gray-700 leading-relaxed">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'ne' and candidate.bio_ne %}
                        {{ candidate.bio_ne|linebreaksbr }}
                    {% else %}
                        {{ candidate.bio_en|linebreaksbr }}
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Political Manifesto -->
            {% if candidate.manifesto_en or candidate.manifesto_ne %}
            <div>
                <h2 class="text-xl font-bold text-gray-900 mb-4">
                    {% trans "Political Manifesto" %}
                </h2>
                <div class="text-gray-700 leading-relaxed manifesto-content">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'ne' and candidate.manifesto_ne %}
                        {{ candidate.manifesto_ne|linebreaksbr }}
                    {% else %}
                        {{ candidate.manifesto_en|linebreaksbr }}
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

    </div>

    <!-- Additional Information Cards -->
    <div class="mt-8 grid grid-cols-1 {% if candidate_events and candidate.donation_link %}md:grid-cols-2 lg:grid-cols-3{% elif candidate_events or candidate.donation_link %}md:grid-cols-2{% endif %} gap-6">
        <!-- Campaign Events - Only show if there are events -->
        {% if candidate_events %}
        <div class="bg-white rounded-xl border border-gray-300 shadow-md p-6 h-full">
            <h3 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-calendar-alt mr-2 text-gray-600"></i>
                {% trans "Upcoming Events" %}
            </h3>
            <div class="space-y-3">
                {% for event in candidate_events %}
                <div class="border-l-4 border-blue-600 pl-4 py-2">
                    <div class="font-medium text-gray-800">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'ne' and event.title_ne %}
                            {{ event.title_ne }}
                        {% else %}
                            {{ event.title_en }}
                        {% endif %}
                    </div>
                    <div class="text-sm text-gray-600">
                        {{ event.event_date|date:"M d, Y" }}
                    </div>
                    {% if event.location_en or event.location_ne %}
                    <div class="text-sm text-gray-600">
                        {% if LANGUAGE_CODE == 'ne' and event.location_ne %}
                            {{ event.location_ne }}
                        {% else %}
                            {{ event.location_en }}
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Contact Information -->
        <div class="bg-white rounded-xl border border-gray-300 shadow-md p-6 h-full">
            <h3 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-address-card mr-2 text-gray-600"></i>
                {% trans "Contact" %}
            </h3>
            <div class="space-y-3">
                {% if candidate.user.email %}
                <div>
                    <span class="text-sm text-gray-600">{% trans "Email:" %}</span>
                    <div class="text-gray-800">{{ candidate.user.email }}</div>
                </div>
                {% endif %}

                {% if candidate.phone_number %}
                <div>
                    <span class="text-sm text-gray-600">{% trans "Phone:" %}</span>
                    <div class="text-gray-800">{{ candidate.phone_number }}</div>
                </div>
                {% endif %}

                {% if candidate.website %}
                <div>
                    <span class="text-sm text-gray-600">{% trans "Website:" %}</span>
                    <div>
                        <a href="{{ candidate.website }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                            {{ candidate.website|slice:"8:"|slice:":-1" }}
                        </a>
                    </div>
                </div>
                {% endif %}

                {% if candidate.facebook_url %}
                <div>
                    <span class="text-sm text-gray-600">{% trans "Social Media:" %}</span>
                    <div>
                        <a href="{{ candidate.facebook_url }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                            {% trans "Facebook Profile" %}
                        </a>
                    </div>
                </div>
                {% endif %}

                {% if not candidate.user.email and not candidate.phone_number and not candidate.website and not candidate.facebook_url %}
                <p class="text-gray-500 text-sm">{% trans "No contact information available" %}</p>
                {% endif %}
            </div>
        </div>

        <!-- Donation Section - Only show if there's a donation link -->
        {% if candidate.donation_link %}
        <div class="bg-white rounded-xl border border-gray-300 shadow-md p-6 h-full flex flex-col">
            <h3 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-donate mr-2 text-gray-600"></i>
                {% trans "Support This Campaign" %}
            </h3>
            {% if candidate.donation_description %}
            <p class="text-gray-700 mb-4 flex-grow">{{ candidate.donation_description }}</p>
            {% else %}
            <p class="text-gray-700 mb-4 flex-grow">{% trans "Your support helps make a difference in our community" %}</p>
            {% endif %}
            <a href="{{ candidate.donation_link }}" target="_blank"
               class="block w-full text-center px-4 py-3 bg-white text-gray-800 border border-gray-300 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                <i class="fas fa-hand-holding-heart mr-2"></i>{% trans "Donate Now" %}
            </a>
        </div>
        {% endif %}

    </div>

    <!-- Navigation -->
    <div class="mt-12 flex justify-center">
        <a href="{% url 'candidates:list' %}"
           class="inline-flex items-center px-6 py-3 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300 font-medium rounded-lg transition-colors">
            {% trans "Back" %}
        </a>
    </div>
</div>

<!-- Add CSS and JS for formatting -->
<style>
    /* Format education and experience with bullets */
    .education-content, .experience-content {
        line-height: 1.8;
    }

    .education-content br + br {
        display: none;
    }

    .experience-content .key-achievements {
        font-weight: bold;
        font-size: 1rem;
        display: block;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        color: #111827;
    }

    /* Format manifesto content */
    .manifesto-content {
        line-height: 1.8;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Format education content with bullet points
        var eduContent = document.querySelector('.education-content');
        if (eduContent) {
            var text = eduContent.innerHTML;
            // Add bullet points if lines start with dash or asterisk
            text = text.replace(/^[-*•]\s*/gm, '• ');
            // Ensure lines that should be bullets have them
            var lines = text.split('<br>');
            var formatted = lines.map(function(line) {
                line = line.trim();
                if (line && !line.startsWith('•') && !line.match(/^[A-Z]+:/) && line.length > 5) {
                    return '• ' + line;
                }
                return line;
            }).join('<br>');
            eduContent.innerHTML = formatted;
        }

        // Format experience content
        var expContent = document.getElementById('experience-content');
        if (expContent) {
            var text = expContent.innerHTML;
            // Add bullet points for experience items
            text = text.replace(/^[-*]\s*/gm, '• ');
            // Make "Key Achievements:" bold and larger
            {% get_current_language as LANGUAGE_CODE %}
            var keyAchievementsText = {% if LANGUAGE_CODE == 'ne' %}'मुख्य उपलब्धिहरू:'{% else %}'Key Achievements:'{% endif %};
            text = text.replace(new RegExp(keyAchievementsText, 'gi'), '<span class="key-achievements">' + keyAchievementsText + '</span>');
            // Format achievement items with dashes
            var lines = text.split('<br>');
            var inAchievements = false;
            var formatted = lines.map(function(line) {
                line = line.trim();
                if (line.includes(keyAchievementsText)) {
                    inAchievements = true;
                    return line;
                }
                if (inAchievements && line && !line.startsWith('-')) {
                    if (line.startsWith('•')) {
                        return line.replace('•', '-');
                    }
                    return '- ' + line;
                }
                if (!inAchievements && line && !line.startsWith('•') && !line.match(/^[A-Z]+:/) && line.length > 5) {
                    return '• ' + line;
                }
                return line;
            }).join('<br>');
            expContent.innerHTML = formatted;
        }

        // Format manifesto content
        var manifestoContent = document.querySelector('.manifesto-content');
        if (manifestoContent) {
            var text = manifestoContent.innerHTML;
            // Make numbered headers bold and uppercase
            text = text.replace(/(\d+\.\s+)([A-Z][A-Z\s]+)/g, function(match, number, title) {
                return '<strong>' + number + title + '</strong>';
            });
            // Format sub-items with dashes
            text = text.replace(/^[-*]\s*/gm, '- ');
            manifestoContent.innerHTML = text;
        }
    });
</script>
{% endblock %}